name: collect-trends-via-api

on:
  schedule:
    - cron: "30 15,18,21,0,3,6,9,12 * * *"
  workflow_dispatch: {}

jobs:
  call_api:
    runs-on: ubuntu-latest
    steps:
      - name: Wake server (optional)
        run: |
          curl -sS --max-time 20 "${{ secrets.RENDER_BASE_URL }}/health" || true

      - name: Trigger store endpoint (with retries)
        env:
          JOB_TOKEN: ${{ secrets.JOB_TOKEN }}
          BASE_URL: ${{ secrets.RENDER_BASE_URL }}
        run: |
          curl -sS -X POST \
            -H "x_job_token: ${JOB_TOKEN}" \
            --retry 5 --retry-all-errors --max-time 120 \
            "${BASE_URL}/api/v1/rss/naver/ranking/collect"
